# 项目目标：建立一个招聘广告发布平台

## 导引

之前我已经说过，我们会在整个课程的学习中搭建一个广告发布平台，这样我们的例子都会以此作为背景，你也会看到这样一个网站是怎样一步步完成的。当然了，你可以按你自己的想法来更改这些例子，把它们用到你想要做的项目中，我甚至很鼓励你这么做。

之所以用“招聘广告发布平台”来做例子，是因为你应该已经知道它是什么了吧（例如eBay等），那你就应该看得懂课程里的例子了。

## 我们的平台

我们要做的平台非常简单，这里是大体的需求介绍：

- 我们需要发布招聘广告，所以要开发一个网站，画一个页面的线框图，用HTML实现模板，等等；
- 我们需要可以浏览，编写，修改和搜索广告；
- 对于每个招聘广告，我们可以添加一张图片；
- 对于每个招聘广告，我们可以关联若干个应聘者；
- 我们会有一些招聘内容的分类（比如开发人员，平面设计人员等等），这些分类会和广告关联。我们可以创建，修改和删除这些分类；
- 对于每个招聘广告，我们可以关联所需技能的水平等级（比如PHP专家，Photoshop熟练掌握者，等等）
- 一开始的时候我们先不做用户管理系统，我们编辑招聘广告的时候需要自己输入姓名。之后我们会加上用户管理到平台中。

## 一些小清理

Symfony2和我们自己已经生成了一些文件，这里面有些冗余，那我们就来愉快地删掉一些吧：

- `Controller/DefaultController.php`控制器；
- `Resources/views/Default`目录；
- 在`Resources/config/routing.yml`文件里的`oc_platform_homepage`路径。

（译者注，以上文件和目录均是相对于`OCPlatformBundle`而言）

还有一个缺省生成的`AppBundle`，我们不会用到，也把它删掉：

- `src/AppBundle`目录；
- `app/AppKernel.php`文件里，删掉有`new AppBundle\AppBundle()`的这一行；
- `app/config/routing.yml`文件里，删掉`app`作为键的那一段（即`app`开头的三行）。

（译者注，以上文件和目录均是相对于Symfony2根目录而言）

## Symfony2的开发流程

如果你现在就刷新页面来检查一切是否正常，那可能会看到一个错误页面！事实上，我们从现在就要行成一个条件反射：清除缓存。为了同时提供大量的功能和优秀的性能，Symfony2大量使用了缓存。

Symfony2缓存是一些可以立即执行的PHP文件组成，它包含了所有Symfony运行所需的信息。相比其它形式的文件，PHP文件可以更快执行。我们拿配置网站用的YAML文件举个例子：当Symfony生成一个页面时，它会把YAML里的配置项编译成一个PHP数组（即`array`），这样下次加载页面时直接使用这个PHP数组从而加快页面生成。

不过在我们修改一些文件之后，缓存就可能变得过期了，这会导致错误。这里有两种情况：

- 生产环境下Symfony2的策略很简单，就是从不重复生成缓存。这样它就不用去反复检查缓存的有效性（这会耗费时间），从而可以快速生成并返回页面给网站用户。解决缓存有效性的方法就是每次你改变了代码，都要手动去清空缓存。我们通过`php app/console cache:clear --env=prod`这个命令来做。
- 开发环境下Symfony2的策略更简单，当你修改代码后，Symfony会在下次页面加载时重新生成大部分缓存，所以你就不一定要总是手工清缓存了。当然，因为它并不是把所有缓存都清掉，所以有时可能会出现一些比较奇葩的bug。在这种情况下，`php app/console cache:clear`命令几秒钟就帮你搞定了。

> 有时执行`cache:clear`命令可能产生一些错误输出。出现这种情况时请尝试再执行一遍这个命令，有时第二遍执行时问题就解决了。如果还没有解决的话，就删除`app/cache/dev`（或者是`app/cache/prod`，取决于环境）目录来手动清楚缓存。

一般而言，开发的流程会是下面这样子的：

- 我修改一些代码，然后测试；
- 我修改一些代码，然后测试；
- 我修改一些代码，然后测试；测试没有通过，我清空缓存：测试就通过了；
- 我修改一些代码，然后测试；
- 我修改一些代码，然后测试；
- 我修改一些代码，然后测试；测试没有通过，我清空缓存：测试就通过了；
- ...
- 一天的工作快结束时，我把所有更新发布到生产服务器，我在生产服务器上必须清空缓存，接着测试下：测试通过。

当然，当我说“测试没有通过”的时候，我的意思是说“这个测试应当通过的，遇到的错误很奇怪”。如果是你代码里本身的错误，那`cache:clear`也无济于事的。:grinning:

## 总结

好了，我们已经学完了创建新页面的全部流程了！这里还有对于本章的几点注释。

首先，如果你没有完全明白这一章的内容，也不用心慌。本章的目的是给你提供一个创建Symfony2页面的全局视角。你现在有了对bundle，路径，控制器和模板的概念——你知道的差不多全了！现在你只是需要深入了解这里每一个概念，我们之后的章节就是为此而设的。

接着，你要知道当你创建第二个页面的时候，不用什么都再做一遍了。你可以现在就建立一个URL为`/byebye-world`的页面，看看自己能否做到。如果你还有困难，那就再读一遍本章；如果你还是不能解决问题，你可以在一些PHP的论坛里提交你的问题，泡论坛里的那些程序员们应该会很高兴帮助你的。:smile:

> 在论坛里，最好在你帖子的标题里加上`Symfony2`这个标签，这样你以后可以很容易找到这个帖子。

最后，我们要做的这个网站平台的所有代码都会放在以下这个地址：。你现在去看还为时过早，因为它包含了我们整个课程期间一步步建立的所有代码。不过它有时可以提供一些帮助，所以时不时去查看一下。:smirk:

好的，你准备好了吗？接下去我们就要玩真的了！

## 本章总结

- 路由的角色就是决定为当前请求使用哪条路径。
- 路径的角色就是把一个URL和控制器里的一个action关联起来。
- 控制器的角色是返回一个`Response`对象给内核，这个对象包含了要返回给网站访客的HTTP应答（无路是一个HTML页面还是一个重定向或其它应答）。
- 视图的角色是把控制器传给它的数据格式化，从而生成一个HTML页面，或者RSS文件，又或者是一个邮件等。
